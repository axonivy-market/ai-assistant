<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://java.sun.com/jsp/jstl/core">

<div class="w-full h-full align-content-start flex flex-column">
  <div class="flex-auto">
    <p:fileUpload id="source-upload"
      listener="#{knowledgeBaseConfigurationBean.handleUploadSource}" mode="advanced"
      chooseIcon="si si-add-small"
      allowTypes="/(\.|\/)(md|txt)$/i" accept=".md,.txt"
      style="display: none;" dragDropSupport="true"
      label="#{ivy.cms.co('/Labels/Select')}"
      auto="true" update="@form"
      dropZone="source-upload" widgetVar="sourceUpload"
      onvalidationfailure="handleUploadFileFail();" />

  <div class="col-12 p-0 pb-3">
    <p:commandButton value="#{ivy.cms.co('/Dialogs/com/axonivy/utils/aiassistant/management/KnowledgeBaseConfiguration/AddSource')}"
      styleClass="w-full col-12 primary-color-light-button"
      onclick="PF('sourceUpload').show();return false;" />
  </div>
  <div class="col-12 p-0 pb-3">
    <h:outputText id="selected-sources-info" value="#{knowledgeBaseConfigurationBean.selectedSourcesInfo}" />
  </div>
  <p:selectManyCheckbox value="#{knowledgeBaseConfigurationBean.selectedSources}" layout="pageDirection" styleClass="selected-sources-checboxes">
    <f:selectItems value="#{knowledgeBaseConfigurationBean.uploadedSources.entrySet()}" var="source"
      itemLabel="#{source.key}" itemValue="#{source.key}" />
    <p:ajax process="@this" update="@form" />
  </p:selectManyCheckbox>
  </div>

  <p:commandButton value="#{ivy.cms.co('/Dialogs/com/axonivy/utils/aiassistant/management/KnowledgeBaseConfiguration/CreateDraftDocuments')}"
    styleClass="primary-color-light-button w-full"
    disabled="#{empty knowledgeBaseConfigurationBean.selectedSources}"
    actionListener="#{knowledgeBaseConfigurationBean.generate}"
    update="documents-form documents-header-section" />

    <script type="text/javascript">
    function handleUploadFileFail() {
      let errorMessageElement = $("[id $= 'knowledge-base-messages']").get(0);
      let uploadError = document.getElementsByClassName('ui-messages ui-widget ui-helper-hidden ui-fileupload-messages');
      let uploadErrorElement = uploadError[0];
      errorMessageElement.style.display = 'block';
      errorMessageElement.appendChild(uploadErrorElement);
    }
    </script>
</div>
</html>